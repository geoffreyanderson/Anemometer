{"name":"Anemometer","body":"Box Anemometer\r\n--------------\r\n\r\nThis is the Box Anemometer, the MySQL Slow Query Monitor.  This tool is used to analyze slow query logs collected from MySQL instances to identify problematic queries.\r\n\r\n### Quickstart ###\r\n\r\nIf you're just completely itching to start using this tool, here's what you need:\r\n\r\n1.\ta MySQL database to store query analysis data in.\r\n2.\t[pt-query-digest](http://www.percona.com/doc/percona-toolkit/pt-query-digest.html).\r\n\t*\tYou may as well just get the whole [Percona Toolkit](http://www.percona.com/doc/percona-toolkit) while you're at it :)\r\n3.\ta slow query log from a MySQL server (see [The Slow Query Log](http://dev.mysql.com/doc/refman/5.5/en/slow-query-log.html) for info on getting one)\r\n4.\ta webserver with PHP\r\n\r\n\r\n#### Setup DB ####\r\n\r\nFirst up, you should connect to the MySQL database you're looking to store the analysis data in and issue the following command:\r\n\r\n    $ mysql -h db.example.com < install.sql\r\n    $ mysql -h db.example.com -e \"grant ALL ON `slow_query_log`.* to 'anemometer'@'%' IDENTIFIED BY 'superSecurePass';\"\r\n\r\n#### Put some data in the DB ####\r\n\r\nNext, grab that slow query log file you have (mine's called \"slow.log\"!), and run pt-query-digest on it:\r\n**NOTE:** I'm using a BASH 3.0 shell here on my MySQL database server! This is so the \"$HOSTNAME\" variable properly replaces with \"db.example.com\")\r\n\r\n    $ pt-query-digest --user=anemometer --password=superSecurePass \\\r\n                      --review h=db.example.com,D=slow_query_log,t=global_query_review \\\r\n                      --review-history h=db.example.com,D=slow_query_log,t=global_query_review_history \\\r\n                      --no-report --limit=0% \\ \r\n                      --filter=\" \\$event->{Bytes} = length(\\$event->{arg}) and \\$event->{hostname}=\\\"$HOSTNAME\\\"\" \\ \r\n                      /var/lib/mysql/db.example.com-slow.log\r\n    Pipeline process 11 (aggregate fingerprint) caused an error: Argument \"57A\" isn't numeric in numeric gt (>) at (eval 40) line 6, <> line 27.\r\n    Pipeline process 11 (aggregate fingerprint) caused an error: Argument \"57B\" isn't numeric in numeric gt (>) at (eval 40) line 6, <> line 28.\r\n    Pipeline process 11 (aggregate fingerprint) caused an error: Argument \"57C\" isn't numeric in numeric gt (>) at (eval 40) line 6, <> line 29.\r\n\r\nYou may see an error like above, that's okay!.\r\nTODO: explain what the options above are doing.\r\n\r\n\r\n#### View the data! ####\r\n\r\nNow, navigate to the web root of your apache server and snag a copy of the Box Anemometer code. Then copy the sample config so you can edit it:\r\n\r\n    $ git clone git@github.com:box/Anemometer.git anemometer\r\n    $ cd anemometer/conf\r\n    $ cp sample.config.inc.php config.inc.php \r\n\r\n\r\nThe sample config explains every setting you may want to change in it.  At the very least, make sure you set the Datasource to the MySQL database you're storing the analyzed digest information in:\r\n\r\n    $conf['datasources']['locahost'] = array(\r\n    \t'host'\t=> 'db.example.com',\r\n    \t'port'\t=> 3306,\r\n    \t'db'\t=> 'slow_query_log',\r\n    \t'user'\t=> 'anemometer',\r\n    \t'password' => 'superSecurePass',\r\n    \t'tables' => array(\r\n    \t\t'global_query_review' => 'fact',\r\n    \t\t'global_query_review_history' => 'dimension'\r\n    \t)\r\n    );\r\n\r\nIn addition, the \"explain\" plugin is enabled by default in the current release and you'll need to setup the username and password it uses to an account that has privileges to explain queries on a given schema on a host.  For example, if you're digesting slow logs that primarily contain queries from the \"world\" database on db.example.com, you'll need to ensure that the user account you put into the following section of the config has the necessary privileges on the \"world\" database on db.example.com.  To do this, scroll down in the sample config to the section containing the plugins configuration and change the 'user' and 'password' parameters to an appropriate account:\r\n\r\n    $conf['plugins'] = array(\r\n            ...\r\n        'explain'       =>      function ($sample) {\r\n            $conn['user'] = 'anemometer';\r\n            $conn['password'] = 'superSecurePass';\r\n            \r\n            return $conn;\r\n        },\r\n    );\r\n\r\n\r\n\r\nNow you should be able to navigate to your webserver in a browser and see Box Anemometer in action!\r\n\r\n\r\n### Phpdocs ###\r\n\r\nPhpdocs for this tool can be found in the \"docs\" sub-directory of the project.\r\n\r\n### Dependencies ###\r\n\r\nThis application requires an Apache webserver with PHP and a MySQL database that contains the data aggregated from MySQL slow query logs.","tagline":"Box SQL Slow Query Monitor","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}